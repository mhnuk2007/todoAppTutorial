<div class="app-container">
  <!-- Header -->
  <header class="app-header text-center mb-3 mb-md-4">
    <div class="brand-icon">
      <i class="fa-solid fa-layer-group"></i>
    </div>
    <h1 class="app-title">TaskFlow</h1>
    <p class="app-subtitle">Focus on what matters most.</p>
  </header>

  <!-- Add Task Section -->
  <section class="custom-card mb-3 mb-md-4">
    <div class="row g-2 g-md-3 align-items-stretch align-items-md-center">
      <!-- Task Input - Always visible -->
      <div [ngClass]="newTask.todoItemId == 0 ? 'col-12 col-sm-8 col-md-9' : 'col-12 col-sm-6 col-md-6'">
        <label for="taskInput" class="visually-hidden">New Task</label>
        <div class="input-group">
          <span class="input-group-text">
            <i class="fa-solid fa-plus"></i>
          </span>
          <input type="text" id="taskInput" [(ngModel)]="newTask.todoItem" class="form-control"
            placeholder="What needs to be done?" />
        </div>
      </div>

      <!-- Status Selector - Only visible when editing -->
      @if(newTask.todoItemId > 0) {
      <div class="col-12 col-sm-6 col-md-3">
        <label for="statusSelect" class="visually-hidden">Status</label>
        <select [(ngModel)]="newTask.status" class="form-select" id="statusSelect">
          <option value="Pending">Pending</option>
          <option value="In Progress">In Progress</option>
          <option value="Completed">Completed</option>
        </select>
      </div>
      }

      <!-- Action Button - Changes based on mode -->
      <div [ngClass]="newTask.todoItemId == 0 ? 'col-12 col-sm-4 col-md-3' : 'col-12 col-sm-12 col-md-3'">
        @if(newTask.todoItemId == 0) {
        <!-- Add Mode -->
        <button (click)="addTask()" type="submit" class="btn btn-primary-custom w-100">
          Add
        </button>
        } @else {
        <!-- Edit Mode -->
        <button (click)="updateTask()" type="submit" class="btn btn-warning w-100">Update</button>
        }
      </div>
    </div>
    @if(newTask.todoItemId > 0) {
    <div class="mt-2">
      <button (click)="onCancelEdit()" class="btn btn-sm btn-outline-secondary w-100 w-sm-auto">
        <i class="fa fa-times me-1"></i> Cancel Edit
      </button>
    </div>
    }
  </section>

  <!-- Controls Section -->
  <div
    class="filters-group d-flex flex-column flex-md-row justify-content-between align-items-stretch align-items-md-center mb-3 mb-md-4 gap-2 gap-md-3">
    <div class="position-relative flex-grow-1">
      <i class="fa-solid fa-search position-absolute top-50 start-0 translate-middle-y ms-3 text-muted"></i>
      <input type="text" class="form-control ps-5" placeholder="Search tasks..." />
    </div>
    <div class="d-flex flex-column flex-sm-row gap-2 w-100 w-md-auto">
      <select class="form-select w-100 w-sm-auto">
        <option selected>All Status</option>
        <option>Pending</option>
        <option>In Progress</option>
        <option>Completed</option>
      </select>
      <select class="form-select w-100 w-sm-auto">
        <option selected>Newest</option>
        <option>Oldest</option>
      </select>
    </div>
  </div>

  <ul class="task-list">
    @if (todoList().length > 0) { @for (item of todoList(); track item.todoItemId) {

    <li class="task-item d-flex flex-wrap flex-md-nowrap align-items-start align-items-md-center"
      [class.completed]="item.status === 'Completed'" [class.editing]="item.todoItemId === newTask.todoItemId">
      <!-- Checkbox -->
      <div class="task-checkbox-wrapper">
        <input type="checkbox" class="task-checkbox" [id]="'task-' + item.todoItemId"
          [checked]="item.status === 'Completed'" (change)="toggleComplete(item)" />

        <label [for]="'task-' + item.todoItemId" class="checkbox-label"></label>
      </div>

      <!-- Content -->
      <div class="task-content flex-grow-1 mb-2 mb-md-0">
        <span class="task-title d-block mb-1"> {{ item.todoItem }} </span>

        <div class="task-meta d-flex flex-wrap align-items-center gap-2">
          <span class="status-badge" [ngClass]="{
              pending: item.status === 'Pending',
              progress: item.status === 'In Progress',
              completed: item.status === 'Completed'
            }">
            {{ item.status }}
          </span>

          <span class="meta-date">
            <i class="fa-regular fa-calendar"></i>
            {{ item.createdDate | date : 'MMM d, y' }}
          </span>
        </div>
      </div>

      <!-- Actions -->
      <div class="task-actions d-flex gap-2 w-100 w-md-auto justify-content-end pt-2 pt-md-0 mt-2 mt-md-0">
        <button (click)="editTask(item)" class="btn-icon edit" aria-label="Edit">
          <i class="fa-solid fa-pen"></i>
        </button>
        <button (click)="deleteTask(item.todoItemId)" class="btn-icon delete" aria-label="Delete">
          <i class="fa-solid fa-trash"></i>
        </button>
      </div>
    </li>
    } }
  </ul>

  <!-- Empty State -->
  @if (todoList().length === 0) {
  <div class="empty-state mt-3 mt-md-4 text-center p-4">
    <i class="fa-solid fa-clipboard-check empty-icon mb-3"></i>
    <h5 class="fs-5 fs-md-4">No tasks found</h5>
    <p class="mb-0 small text-muted">You're all caught up! Add a new task above.</p>
  </div>
  }
</div>